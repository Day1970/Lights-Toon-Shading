
<!DOCTYPE html5>
<html>
    <head>
        <title>Lights and Toon-Shading</title>
<style>
    body {background-color: rgb(33, 56, 83); display:flex; flex-direction: column; align-items: center; justify-content: right;}
    canvas {border: 1px solid #356;}

        .instruction_text_headline {
        color: rgb(130, 187, 233);
        font-size: 15px;
        text-align: left;
        }

        .instruction_p {
        font-weight: normal;  
        }
</style>
        <script src="ext/gl-matrix.js"></script>
        <script src="GVT_Src_vertexData_plane.js"></script>
        <script src="GVT_Src_vertexData_sphere.js"></script>
        <script src="GVT_Src_vertexData_torus.js"></script>
        <script src="BEL_Src_tpl.js"></script>
        <script type="x-shader/x-vertex" id="vertexshader">
            attribute vec3 aPosition;
            attribute vec3 aNormal;
            
            uniform mat4 uPMatrix;
            uniform mat4 uMVMatrix;
            uniform mat3 uNMatrix;
            
            //uniform vec4 uColor;
            varying vec4 vColor;
                        
            // Ambient light.
            uniform vec3 ambientLight;
            
            // Pointlights.
            const int MAX_LIGHT_SOURCES = 8;
            struct LightSource {
                bool isOn;
                vec3 position;
                vec3 color;
            };
            uniform LightSource light[MAX_LIGHT_SOURCES];
            
            // Material.
            struct PhongMaterial {
                vec3 ka;
                vec3 kd;
                vec3 ks;
                float ke; 
            };
            uniform PhongMaterial material;
            
            // Phong illumination for single light source,
            // no ambient light.
            vec3 phong(vec3 p, vec3 n, vec3 v, LightSource l) {
                {
				
            vec3 L = l.color;

            vec3 s = normalize(l.position - p);
            vec3 r = reflect(-s, n);
            
            float sn = max( dot(s,n), 0.0);
            float rv = max( dot(r,v), 0.0);
                        
            vec3 diffuse = material.kd * L * sn;
                            
            vec3 specular = material.ks * L * pow(rv, material.ke);

            return diffuse + specular;			
        }
            
                return vec3(0.0);
            }
            
            // Phong illumination for multiple light sources
            vec3 phong(vec3 p, vec3 n, vec3 v) {
            
                // Calculate ambient light.
                vec3 result = material.ka * ambientLight;
                
                // Add light from all light sources.
                for(int j=0; j < MAX_LIGHT_SOURCES; j++){
                    if(light[j].isOn){
                        result += phong(p, n, v, light[j]);
                    }
                }
                return result;
            }
            
            void main(){
                // Calculate vertex position in eye coordinates. 
                vec4 tPosition = uMVMatrix * vec4(aPosition, 1.0);
                // Calculate projektion.
                gl_Position = uPMatrix * tPosition;
            
                vec3 tNormal = normalize(uNMatrix * aNormal);
                
                // Calculate view vector.
                vec3 v = normalize(-tPosition.xyz);    
                                
                vColor = vec4( phong(tPosition.xyz, tNormal, v), 1.0);
            }
        </script>
        <script type="x-shader/x-fragment" id="fragmentshader">
            precision mediump float;

            varying vec4 vColor;

            uniform bool useToon;

            void main() {
                vec3 color = vColor.rgb;

                if (useToon) {
                    // Quantisierung in 3 Stufen
                    float intensity = (color.r + color.g + color.b) / 3.0;
                    if (intensity < 0.33)
                        color *= 0.33;
                    else if (intensity < 0.66)
                        color *= 0.66;
                    else
                        color *= 1.0;
                }

                gl_FragColor = vec4(color, 1.0);
            }

        </script>
    </head>
    <body onload="app.start()">
        
        <h1 style="color:white; font-size: 46px;">
    Lights on Orbit and Toon-Shading 빛들
   <p style="color:white; font-size: 16px; text-align: left;">
    Aufgabenstellung: Erweitern Sie die Aufgabe Bel-3 (oder Bel-2 in schwarz-weiß) aus der Lerneinheit BEL (Kap. 14.9).  
    <br>
    Auf einen Tastendruck sollen sich die beiden Lichter in der Szene gleichzeitig auf einer Kreisbahn um die Modelle bewegen. 
    <br>
    Sie bewegen sich unabhängig von der Kamera (nicht wie ein Licht, das fest auf der Kamera montiert ist). 
    <br> <br>
    Erweiterungen: Schattieren Sie die Szene im Stil eines traditionellen Zeichentrickfilms mit einem Toon-Shader.
    <br>
    Interaktion: Schrittweise Bewegung der Lichter in eine vorbestimmte Richtung über wiederholten Tastendruck der Taste 'l' oder 'L'. 
     <br>
     An- und abschalten des Toon-Shaders  über die Taste "T". (Quantisierung in 3 Stufen)
    <br>

    <p style="color: white; font-size: 20px; text-align: left;">Press key <span style="color: rgb(177, 221, 105);">A</span> to start (and stop) the animation or rotation of the two lights.
    <br>
    Press key <span style="color: rgb(177, 221, 105);">T</span> to switch the Toon-Shader on or off.
    </p>
    <p style="color: white; font-size: 20px; text-align: left;">Press key <span style="color: rgb(177, 221, 105);">L / l </span>to rotate the lights manually (to the left).
    <br>
    Press key <span style="color: rgb(177, 221, 105);">R / r</span> to rotate the lights manually (to the right).
   <p style="color: white; font-size: 20px; text-align: left;">Press key <span style="color: rgb(177, 221, 105);">C, H, D</span> or <span style="color: rgb(177, 221, 105);">V</span>  to rotate the camera or the scene manually. 
    <br>The perspective can be changed with key <span style="color: rgb(177, 221, 105);">O, F </span> and <span style="color: rgb(177, 221, 105);">P</span>.
    <br>
    <canvas id="canvas" width="900" height="800"></canvas>
      <div class="instruction_text_headline">
 <h3 style="color: white; font-size: 15px; text-align: left; margin-top: 35px;">Material Sources and Documentation</h3>

  <p class="instruction_p" >JS-, HTML-IDE: Visual Studio Code; Graphical Visualisation Technologies (BHT MIM 20 W25), EA8 - HS-Emden-Leer </p>
  <p class="instruction_p">Note: I used the spheres, the torus, the plane and the gl.matrix from the example program from the TFM learning units (11) and (14.9) <a href="https://vfhgvt.eduloop.de/loop/TFM_-_Transformationen_und_Bewegung" target="_blank">Loop GVT - Graphical Visualisation Technologies</a>.</p>
    </div>

</html>